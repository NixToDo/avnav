<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>AvNav OCharts</title>
    <link href="../styles.css" rel="stylesheet" type="text/css">
  </head>
  <body data-order="700" class="fimage">
    <h1>Avnav Ocharts(NG)</h1>
    <div class="toc" data-maxlevel="3"></div>
    <p>AvNav ochartsng ist eine neue Implementierung als Ersatz für das <a href="ocharts.html">AvNav
        ocharts plugin</a>.<br>
      Diese hat eine Reihe von neuen Funktionen:</p>
    <ul>
      <li>Sie läuft jetzt auch unter Android (siehe <a href="#android">unten</a>)</li>
      <li>Es gibt eine direkte Onlineverbindung zum O-Charts Shop</li>
      <li>Es können jetzt auch unverschlüsselte S57 Karten verwendet werden
        (nach einer einmaligen <a href="#chartconversions">Konvertierung</a>)</li>
      <li>Die Anzeige kann noch stärker angepasst werden</li>
      <li>Es werden keine großen Disk-Caches mehr angelegt. Das verringert die
        Schreiblast auf der SD Karte und die CPU Last.write load and a lot of
        CPU load</li>
      <li>Es braucht keinen Restart mehr, wenn neue Karten hinzugefügt werden.</li>
      <li>Es können mehr Prozessorkerne genutzt werden und es sollte auf den
        meisten Systemen schneller laufen.</li>
      <li>Es werden wesentlich weniger externe Pakete benötigt. Insbesondere
        auch keine lauffähiges X11 Umgebung.</li>
      <li>Es wird weniger Speicher benötigt.</li>
      <li>...</li>
    </ul>
    <p><a name="restrictions"></a>Momentan ist diese Implementierung im Beta
      Zustand. Es gibt daher noch einige Einschränkungen und es können auch noch
      Fehler vorhanden sein.</p>
    <ul>
      <li>Es können noch keine oeRNC Karten (Rasterkarten von o-charts) gelesen
        werden</li>
      <li>Es können Anzeige Fehler auftreten</li>
      <li>Unter Android kann man nicht die gleiche Lizenz für OpenCPN und AvNav
        benutzen</li>
      <li>Unter Android dürfen AvNav und OpenCPN nicht parallel laufen</li>
    </ul>
    <h2>Übersicht</h2>
    <div class="toc"> </div>
    <p>AvNav kann Karten in verschiedenen Raster-Formaten verarbeiten. Bisher
      war es aber nicht in der Lage, offiziell verfügbare Seekarten zu lesen und
      anzuzeigen. Seit einiger Zeit gibt es die Firma <a href="https://o-charts.org/">o-charts</a>,
      die Karten für viele Gebiete der Erde für OpenCPN bereitstellt. </p>
    <p>Nach einigen Absprachen mit der Firma können diese Karten nun auch für
      AvNav genutzt werden (ab Version&nbsp; 2024xxx mit diesem neuen plugin - <a
        href="#Installation">siehe unten</a>). Bisher können die oesenc
      Vektor-Karten genutzt werden.</p>
    <p>Bisher können die oesenc Vektor-Karten genutzt werden. Das erledigt ein
      neues Plugin für AvNav (avnav-ochartsng). Die Umwandlung erfolgt dabei im
      laufenden Betrieb immer dann, wenn die Karten dargestellt werden sollen.
      Ein gewisser Teil der Kartenkacheln wird im Server im Speicher aufbewahrt,
      so das diese sehr schnell erneut bereitgestellt werden können. Das
      beschleunigt die Anzeige, wenn man zwischen verschiedenen Zoom Stufen
      wechselt oder mehrere Displays angeschlossen sind.</p>
    <p>Das Handling der Karten erfolgt dabei vollständig durch das Plugin - das
      betrifft auch die Installation (die Karten können nicht über die normale <a
        href="../userdoc/downloadpage.html">Download-Seite</a> hochgeladen
      werden). Das Plugin hat dazu eine eigene GUI, die von der Hauptseite über
      den Button <img src="../viewerimages/icons-new/apps.svg" alt="" class="inlineimage">(User
      Apps) und dort über den Button Ocharts-Provider <img src="ochartsngicon.png"
        alt="" class="inlineimage"> erreichbar ist.</p>
    <p> <img src="ochartsng-gui1.png" class="fimage"></p>
    <br>
    <h2>Karten Typen</h2>
    <p>AvNav ochartsng kann die o-chart Vektorkarten darstellen (oeusenc) - so
      wie in diesem Dokument beschrieben.<br>
      Ausserdem können unverschlüsselte Vektorkarten (S57) benutzt werden. Diese
      sind für verschiedene Regionen frei zum Download verfügbar.<br>
      Um solche S57 Karten nutzen zu können, müssen sie zunächst in das genutzte
      OpenCPN SENC Format umgewandelt werden.<br>
      Für eine Anleitung zur Konvertierung siehe <a href="#chartconversions">Karten
        Konvertierungen</a>.</p>
    <h2><a name="Charts"></a>Erwerb und Installation der Karten</h2>
    <p>Wichtiger Hinweis: <span style="color: #ff6666;">Wenn man keinen Dongle
        von o-charts hat, sind die Karten an das System gebunden. Wenn es daher
        beim Einbringen oder bei der Nutzung der Karten Probleme gibt, bitte <b>nicht</b>
        das System neu aufsetzen - sondern eine Reparatur versuchen. Wenn man
        das System neu aufsetzt, werden die Lizenzen ungültig. Ich helfe gerne
        bei Problemen - Kontakt z.B. per <a href="mailto:andreas@wellenvogel.net">email</a>.</span>
    </p>
    <p>Nur bei Nutzung der AvNav Images ist auch ein update der Images möglich.
      Bitte im Zweifel vorher testen.</p>
    Um bei ocharts Karten kaufen zu können, muss <a href="https://o-charts.org/shop/de/autenticacion?back=my-account">dort</a>
    zunächst ein Konto angelegt werden.<br>
    Anschliessend muss man seine Systeme, auf denen man die Karten nutzen möchte
    <a href="https://o-charts.org/shop/de/module/occharts/occharts">auf der
      Seite von o-charts</a> registrieren.
    <p>Für den gesamten Prozeß gibt es zwei Wege - den "<a href="https://o-charts.org/manuals/?lng=en">Online
        Proceß</a> " und den <a href="https://o-charts.org/manuals/offline.php?lng=en">"Offline
        Prozeß"</a> . <br>
      Der online Prozeß erfordert, das das System (auf dem der AvNav Server
      läuft - das muss nicht das System sein, auf dem der Browser läuft) mit dem
      Internet verbunden ist.<br>
      Für Android ist die Registrierung eines neuen Systems nur über den online
      Prozeß möglich.</p>
    <h3><a name="offlineprocess"></a>Der Offline Prozeß</h3>
    Dieser besteht aus den folgenden Schritten:
    <ol>
      <li>Erzeugung eines "Fingerprints" für das System, auf dem die Karten
        genutzt werden sollen. Dieser kann in AvNav über die Bedienoberfläche
        des Plugins erzeugt und heruntergeladen werden.</li>
      <li>Hochladen dieses Fingerprints zu o-charts und Anlegen eines Systems
        (im Wesentlichen Vergabe eines Namens)</li>
      <li>Kaufen von Karten</li>
      <li>Zuordnen zu dem angelegten System</li>
      <li>Nach kurzer Zeit gibt es eine Mail von o-charts mit einem
        Download-Link für die Karten (Zip-File)</li>
      <li>Hochladen der Karten in AvNav (wieder über die Bedienoberfläche des
        Plugins).</li>
    </ol>
    <p>Für Updates werden die Schritte 4,5 und 6 wiederholt (bei 4 nur
      Anforderung des Updates).</p>
    <p>Für weitere Kartensätze Schritte 3-6.</p>
    Für die Schritte 2,3,4 und 5 wird natürlich ein System mit
    Internet-Verbindung benötigt. Das kann z.B. ein Laptop oder auch ein Android
    Tablet sein.<span style="color: red;"></span><br>
    <span style="color: red;"></span>
    <p><span style="color: red;">Wichtiger Hinweis für Android</span>: Die
      Registrierung eines Systems (Schritte 1 und 2) können nur im <a href="#onlineprocess">Online
        Prozeß</a> erledigt werden. </p>
    <p>Für den Ablauf des Offline-Prozesses habe ich ein <a href="https://www.youtube.com/watch?v=q24VRAtbbEE">Video</a>
      gemacht, um ihn zu verdeutlichen. Hier noch einmal eine kurze Beschreibung
      dazu.</p>
    <p><b>Hinweis</b>: Wenn die Karten auf dem gleichen System bereits für
      OpenCPN registriert sind, dann kann man direkt mit Schritt 6 starten (aber
      nicht für Android - siehe die&nbsp; <a href="#restrictions">Einschränkungen</a>
      oben). </p>
    <h4>Erzeugung des Fingerprints</h4>
    <p>Über <img src="../viewerimages/icons-new/apps.svg" alt="" class="inlineimage">-&gt;<img
        src="ochartsngicon.png" class="inlineimage"> auf die Oberfläche des
      Plugins gehen, dort den Tab "Charts" auswählen.</p>
    <img src="ochartsng-gui-charts1.png" class="fimage">
    <p>Mit "Get Fingerprint" die Erzeugung des Fingerprints anstossen. Falls man
      einen Dongle von o-charts benutzt, den Fingerprint über "Get
      Fingerprint(Dongle)" erzeugen. Dieser wird nur sichtbar, wenn ein dongle
      erkannt wurde (Dongle Zeile grün).</p>
    <p><img src="ochartsng-gui-charts2.png" class="fimage"></p>
    <p>Im Dialog die erzeugte Datei auf meinem Gerät speichern.</p>
    <h4>Hochladen des Fingerprints zu o-charts</h4>
    <p>Auf die <a href="https://o-charts.org/shop/de/module/occharts/occharts">o-charts
        Seit</a>e gehen und den Fingerprint hochladen.</p>
    <img src="ocharts-buying.png" alt="" class="fimage">
    <p>Mit Choose File die unter 2. gespeicherte Datei wählen. Dazu einen
      sinnvollen Namen vergeben (dieser findet sich später in den Mails mit den
      Download Links).</p>
    <h4>Kaufen von Karten</h4>
    <p>Bei o-charts aus den verfügbaren <a href="https://o-charts.org/shop/de/8-oesenc">oeSENC
        Karten</a> die gewünschten kaufen.</p>
    <h4>Zuordnen zum angelegten System</h4>
    <img src="ocharts-assign.png" alt="" class="fimage">
    <p>Bei 1 kann die Zuordnung zu einem angelegten System erfolgen (hier nicht
      mehr möglich, weil die Karten bereits zu den 2 maximal verfügbaren
      Systemen zugeordnet sind). Bei 2 wird dann die Mail mit dem Download-Link
      angefordert (das erfolgt auch bei Updates - hier im Bild zu sehen: Die
      letzte abgerufene Version ist 21, verfügbar ist 23).</p>
    <h4>Herunterladen der Karten</h4>
    <img src="ocharts-download.png" alt="" class="fimage">
    <p>Nach kurzer Zeit erhält man von o-charts eine Mail mit dem Download-Link.
      Diese Datei (zip) herunterladen.</p>
    <h4>Hochladen der Zip-Datei zu AvNav</h4>
    <p><img src="ochartsng-upload1.png" class="fimage"></p>
    In der GUI des o-chart plugins über "Upload Zip" die im Schritt 5.
    heruntergeladene Datei zu AvNav hochladen. <br>
    Während des Uploads wird ein Fortschritt angezeigt.
    <p><img src="ochartsng-upload2.png" class="fimage"></p>
    <p>Am Ende des Uploads wird auf dem AvNav Server die Datei ausgepackt, und
      es werden einige Prüfungen durchgeführt (das kann einige Sekunden dauern).</p>
    <p>Die Karten werden (falls nicht anders konfiguriert) in das Verzeichnis
      /home/pi/avnav/data/ocharts/charts hochgeladen.</p>
    <p> Wenn die neu hochgeladenen Karten ein Update für einen bereits
      existierenden Kartensatz enthalten, wird der existierende Satz
      deaktiviert. Das kann man später mit Enable/Disable/Auto ändern.
      Kartensätze, die nicht mehr benötigt werden, können gelöscht werden.</p>
    <p><span style="color: red;">Wichtiger Hinweis</span>: Die Karten stehen auf
      der o-charts Seite nur während ihres Gültigkeitszeiraumes (1 Jahr) zum
      Download bereit. Daher sollte die zip Datei noch einmal sicher aufbewahrt
      werden. Man kann diese auch zu AvNav hochladen und nutzen, wenn dieser
      Gültigkeitszeitraum abgelaufen ist. Man hat dann natürlich keine Updates
      mehr.</p>
    <p>Wenn alle Karten erfolgreich eingelesen wurden, wird der Status sich zu
      grün ändern (READY).</p>
    <p><img src="ochartsng-upload4.png" class="fimage"></p>
    Falls der Status zu "ERROR" (rot) wird, wurde u.U. ein Zip-File hochgeladen,
    was für ein anderes System zugeordnet war. Details kann man im Log File
    (/home/pi/avnav/data/ocharts/provider.log) sehen. <br>
    Nun sind die Karten verfügbar und können genutzt werden.
    <p><img src="ocharts-mainpage.png" alt="" class="fimage"></p>
    <p><img src="ocharts-navpage.png" alt="" class="fimage"></p>
    <p><br>
    </p>
    <h3><a name="onlineprocess"></a>Der Online Prozeß</h3>
    <p>Damit man den Online Prozeß nutzen kann, muss das System, auf dem AvNav
      läuft(der Server, nicht der Browser!) mit dem Internet verbunden sein.</p>
    <p>Der Prozeß erlaubt es, ein System zu registrieren, zu prüfen, ob das
      aktuelle System im Shop bekannt ist und sich die Karten, die diesem System
      zugeordnet wurden anzeigen zu lassen. Man kann diese dann direkt
      herunterladen und installieren.<br>
      Das eigentliche Kaufen der Karten und die Zuordnung zum System muss über
      die o-charts Webseite vorgenommen werden. Ein der ochartsNG Weboberfläche
      ist ein Link-Button vorhanden, der einen direkt dort hin bringt.<br>
      AvNav ochartsng speichert keine Login-Daten für den Shop. Da aber die
      Applikation ja im Browser läuft, können die Login Daten dort gespeichert
      werden (wie für jede andere Webseite).</p>
    <p><span style="color: red;">Sicherheitshinweis</span>: Die Kommunikation
      zwischen AvNav ochartsng und dem o-charts Shop ist verschlüsselt. Die
      Kommunikation zwischen dem Browser und dem AvNav Server aber nicht. Daher
      darf der Online Prozeß nur verwendet werden, wenn man sich in einem
      sicheren WLAN befindet (z.B. hinter einem LTE Router oder einem mobilen
      Hotspot) - niemals aber in einem öffentlichen WLAN.</p>
    <p><img src="ochartsng-shop1.png" alt="" class="fimage"> </p>
    <p>Wenn man den "Shop" Reiter öffnet ist man zunächst nich im Shop
      eingelogged. Man kann sehen, ob momentan ein Dongle aktiv ist oder nicht.
      Über den "ShopPage" Button gelangt man direkt zur o-charts Webseite (aber
      es macht mehr Sinn, sich zunächst einzuloggen).</p>
    <p>Mit einem Klick auf "Login" und eingabe von Nutzername und Passwort
      logged man sich im o-charts Shop ein.</p>
    <p><img src="ochartsng-shoploggedin.png" alt="" class="fimage"></p>
    <p>Wenn das System bereits im Shop registriert wurde, wird der "Shop name"
      (d.h. der dort genutzte Name für das System) angezeigt und die Liste der
      Karten/Updates die dem System zugeordnet wurden(siehe <a href="#offlineprocess">Offline
        Prozeß</a>) wird angezeigt.<br>
      Wenn eine Version einer Karte im Shop neuer ist als die lokale (oder eine
      Karten lokal noch nicht vorhanden ist) kann man sie direkt installieren.</p>
    <p><img src="ochartsng-shopupdate.png" alt="" class="fimage"></p>
    <p><img src="ochartsng-shopdownload.png" alt="" class="fimage"></p>
    <p>Nach dem Herunterladen wirde die Karten entpackt und kann sofort genutzt
      werden. Wenn es ein update für eine existierende Karte ist, wird die neue
      Version aktiv und die alte wird "disabled" (gleiche Verhalten wie beim
      Upload einer Karte). Auf dem "Charts" Reiter kann man später die alte
      Version löschen, wenn man sie nicht mehr benötigt.</p>
    <p><span style="color: red;">Wichtiger Hinweis</span>:<br>
      Die Karten im Shop bleiben nur während ihrer Gültigkeitsdauer (1 Jahr)
      verfügbar. Bitte daher die Karten noch einmal lokal sicher aufbewahren.
      Das kann man entweder durch Anforderung auf der Shop-Webseite (wie im
      Offline Prozeß) tun oder man kann die ZIP Datei direkt vom "Charts" Reiter
      herunterladen.</p>
    <p>Wnn das System im Shop noch nicht bekannt ist, kann man es hier
      registrieren.</p>
    <p><img src="ochartsng-shopunknown.png" alt="" class="fimage"></p>
    Auf einem Linux System wird man nach einem Namen für das System gefragt,
    unter Android ist der Name voreingestellt und kann nicht geändert werden.<br>
    <p>Wenn man das System registriert hat, kann man über "ShopPage" direkt zur
      Shop Webseite gehen und Karten kaufen bzw. zuordnen. Wenn man von dort
      zurückkehrt muss man über "Refresh" die Liste der zugeordneten Karten
      aktualisieren.</p>
    <p><br>
    </p>
    <h2><a name="MainSettings"></a>Adapting the Look and Feel</h2>
    <p>As the o-charts are vector charts you can adjust their look and feel.
      However some limitations must be considered:</p>
    <ol>
      <li>The modifications apply to the server's chart settings - so they will
        become effective for all displays.</li>
      <li>If you change the look and feel all data in the internal cache is
        wiped and the chart tiles must be rendered from scratch. So this will
        (potentially) introduce some delays on systems with less computing
        power.</li>
    </ol>
    <p>Changing display parameters is done in the plugin GUI(<img src="../viewerimages/icons-new/apps.svg"
        alt="" class="inlineimage">-&gt;<img src="ochartsngicon.png" class="inlineimage">),
      tab "Main Settings".</p>
    <img src="ochartsng-settings1.png" class="fimage">
    <p>If you change a setting (1) it will be displayed bold. Changes will only
      become effective when you click "Update Settings"(2).<br>
      When you changed the settings the chart display will be rebuild. This will
      typically cause a small delay with no display at all.</p>
    <p>By selecting "Cancel" you can revert your changes. "Defaults" will reset
      to the built-in defaults. Most parameters are similar to the ones you find
      at&nbsp; <a href="https://opencpn.org/wiki/dokuwiki/doku.php?id=opencpn:opencpn_user_manual:options_setting">OpenCPN
        settings</a>.</p>
    <p>The following parameters are available.</p>
    <table border="1" width="100%">
      <tbody>
        <tr>
          <td>Name</td>
          <td>Meaning</td>
          <td>Default</td>
        </tr>
        <tr>
          <td>Show Text</td>
          <td>show text for chart objects</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Important Text Only</td>
          <td>hide less important text</td>
          <td>false</td>
        </tr>
        <tr>
          <td>Light Descriptions</td>
          <td>show descriptions for lights</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Show Depths</td>
          <td>show soundings</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Show Quality</td>
          <td>show extra objects indicating the quality</td>
          <td>false</td>
        </tr>
        <tr>
          <td>Chart Information Objects</td>
          <td>show informational objects</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Buoy/Light Labels</td>
          <td>show labels for buoys and lights</td>
          <td>true</td>
        </tr>
        <tr>
          <td>National text on chart</td>
          <td>show national text</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Show Lights</td>
          <td>show lights</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Show Anchor Info</td>
          <td>show anchoring information</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Color Scheme</td>
          <td>The color scheme to be used for the chart display</td>
          <td>DAY_BRIGHT</td>
        </tr>
        <tr>
          <td>Chart Bounds</td>
          <td>Show the chart bounding boxes</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Reduced Detail at Small Scale</td>
          <td>reduce details at lower zoom levels</td>
          <td>true</td>
        </tr>
        <tr>
          <td>De-Cluttered Text</td>
          <td>improve text positioning</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Display Category</td>
          <td>Base, Standard, All, User Standard</td>
          <td>Standard</td>
        </tr>
        <tr>
          <td>Graphics Style</td>
          <td>Paper Chart, Simplified</td>
          <td>Paper Chart</td>
        </tr>
        <tr>
          <td>Boundaries</td>
          <td>Plain, Symbolized</td>
          <td>Plain</td>
        </tr>
        <tr>
          <td>Colors</td>
          <td>4Color, 2 Color</td>
          <td>4 Color</td>
        </tr>
        <tr>
          <td>Text Font Size</td>
          <td>Scaling for text on charts</td>
          <td>1 (ca. 12px)</td>
        </tr>
        <tr>
          <td>Soundings Font Size</td>
          <td>Scaling for soundings</td>
          <td>1 (ca. 12px)</td>
        </tr>
        <tr>
          <td>Scale</td>
          <td>Base scaling. Higher values for more details on lower zoom levels</td>
          <td>1</td>
        </tr>
        <tr>
          <td>UnderZoom</td>
          <td>Number of zoom levels to downscale higher resolution chart tiles
            if no chart tile is available at the requested zoom level.</td>
          <td>4</td>
        </tr>
        <tr>
          <td>AreaUnder</td>
          <td>If with in the under zoom range still no charts have been found,
            just try some lower zoom layers - but only display the areas (land,
            depth) - no other information.<br>
            Be careful when increasing this as this could impact the performance
            a lot.</td>
          <td>2</td>
        </tr>
        <tr>
          <td>OverZoom</td>
          <td>Number of zoom levels to upscale a lower resolution chart tile if
            is no chart tile is available with better resolution.<br>
            <b>Hint</b>: Scale, UnderZoom and OverZoom, AreaUnder heavily
            influence the cost of the rendering process as they determine the
            number of charts to be processed to generate a single chart tile.
            Lower values normally mean less charts (i.e. being faster) - but
            there could be white areas between chart tiles. The defaults should
            be a good compromise.</td>
          <td>4</td>
        </tr>
        <tr>
          <td>Scale Tolerance</td>
          <td>When scaling the map or the symbols (symbol scale) all the symbols
            have to be rendered on those scaled values.<br>
            To avoid too much additional symbols you can allow a small tolerance
            here.</td>
          <td>0.1</td>
        </tr>
        <tr>
          <td>Rotation Tolerance</td>
          <td>When Objects (symbols, lines, lights... have to be rotated on the
            map for each different angle a new symbol has to be created. To
            optimize performance and memory usage we can allow a small tolerance
            here so that a couple of different angles can use the same rotated
            symbol (in degrees)</td>
          <td>2</td>
        </tr>
        <tr>
          <td>SymbolScale</td>
          <td>Scale the display of symbols. Some of the symbols are build out of
            raster data - so a scale &gt; 2 could already make theme look very
            ugly.</td>
          <td>1</td>
        </tr>
        <tr>
          <td>Depth</td>
          <td>Unit for soundings(Meters, Feet, Fathoms)</td>
          <td>Meters</td>
        </tr>
        <tr>
          <td>Shallow Depth</td>
          <td>Adjust to your needs</td>
          <td>2</td>
        </tr>
        <tr>
          <td>Safety Depth</td>
          <td>Adjust to your needs</td>
          <td>3</td>
        </tr>
        <tr>
          <td>Deep Depth</td>
          <td>Adjust to your needs</td>
          <td>5</td>
        </tr>
      </tbody>
    </table>
    <p>At the tab "Detail Settings" you can switch on/off particular chart
      features. Those detail settings will only become effective when using the
      display category "User Standard".</p>
    <h2><a name="featureinfo"></a>Feature Info (Object Query)</h2>
    <p>When you click on a chart you will heav AvNav's Feature info. This will
      be extended by some important information found around the click position.</p>
    <img src="FeatureInfo-OCharts1.png" alt="" class="fimage">
    <p>By clicking "Info" you can view the raw information from the chart.</p>
    <p><img src="ochartsng-featureinfo2.png" class="fimage"> </p>
    <p> By clicking the blue chart name you can get some more information about
      the chart that this object belongs to.</p>
    <img src="ochartsng-featureinfo3.png" alt="" class="fimage">
    <h2><a name="Installation"></a>Installation</h2>
    <h3>Linux/Raspberry</h3>
    <p>The plugin is available as a debian package.<br>
      As the plugin is currently in a beta phase, the packages are still not
      part of the official repositories.</p>
    <p>For the <a href="../install.html#Headless">Headless Images</a> the
      necessary packages can be found in the beta repository. To enable it you
      can edit the file /etc/apt/sources.list.d/extra.list to enable the beta
      repository.<br>
      Start the editor with:</p>
    <div class="code">sudo nano /etc/apt/sources.list.d/extra.list</div>
    <div class="code"><span style="color: red;">#</span>deb [signed-by=/usr/share/keyrings/oss.boating.gpg] https://www.free-x.de/debpreview bullseye main contrib non-free
    deb [signed-by=/usr/share/keyrings/oss.boating.gpg] https://www.free-x.de/debian bullseye main contrib non-free</div>
    <p>Just remove the hash mark at the debpreview line. Afterwards you can
      install the package normally with the avnav updater:</p>
    <ul>
      <li>avnav-ochartsng</li>
    </ul>
    <p>If you want to do this from the command line execute:</p>
    <ul>
    </ul>
    <div class="code">sudo apt-get update<br>sudo apt-get install avnav-ochartsng-plugin<br>sudo systemctl restart avnav</div>
    <p>If you are working on other images you should add the repository from
      free-x (adapt "bullseye" to your debian release):</p>
    <p>Refer to the <a href="../install.html#Packages">AvNav package install
        description</a>.</p>
    <div class="code">deb https://www.free-x.de/debpreview bullseye main contrib non-free</div>
    <p>Alternatively you can download the packages them from the <a href="../../downloads/daily-ochartsng">daily
        builds directory</a>.</p>
    <p>To use one of those packages just download and install the package
      (replace the version by the one you want): </p>
    <div class="code">cd /home/pi/avnav<br>wget -O avnav-ochartsng_20240214-raspbian-bullseye_armhf.deb https://www.wellenvogel.net/software/avnav/downloads/daily-ochartsng/20240214/avnav-ochartsng_20240214-raspbian-bullseye_armhf.deb<br>sudo apt install ./avnav-ochartsng_20240214-raspbian-bullseye_armhf.deb<br>sudo systemctl restart avnav</div>
    <h2><a name="Releases"></a></h2>
    <p> You can also download to a PC, transfer by scp/WinScp to the pi and
      install then. </p>
    <h4>AvNav-ocharts and AvNav-ochartsng Together</h4>
    <p>When you install the new avnav-ochartsng-plugin you will get some
      conflict with the existing ocharts plugin. At the end both will try to use
      the same port - so at least one of the two will fail to start.<br>
      The suggested solution is to disable the ocharts-plugin on the&nbsp;<img src="../viewerimages/icons-new/status.svg"
        alt="" class="inlineimage"> <a href="../userdoc/statuspage.html">server/status
        page</a>.<br>
      Additionally enable the "useLegacy" switch in the <a href="#PluginConfig">PluginConfig</a>
      of the ochartsng plugin. This way the new plugin will also use all the
      charts that you installed with the old one.</p>
    <p>If you would like to run both plugins in parallel change the port of the
      ochartsng plugin to e.g. 8083. Running both in parallel should only be
      done if your system has sufficient RAM (at least 2GB).</p>
    <h3>Android</h3>
    <p>On android there is an extra app that will contain the ochartsng.</p>
    <p>See <a href="#android">AndroidApp</a> below.</p>
    <h2><a name="Releases"></a>Releases</h2>
    <p>You can find all releases and intermediate developer builds (daily
      builds) at:</p>
    <ul>
      <li><a href="../../downloads/release-ochartsng">Releases</a></li>
      <li><a href="../../downloads/daily-ochartsng">Daily Builds</a></li>
    </ul>
    <ul>
    </ul>
    <h3>Release Versions</h3>
    <p>-- none yet --</p>
    <ul>
    </ul>
    <h2><a name="License"></a>License Notes</h2>
    <p>Using the charts in AvNav with the oesenc-pi plugin has been agreed with
      o-charts and therefore is inline with their license conditions.<br>
      You have to agree to the <a href="https://o-charts.org/manuals/docs/EN_rrc_eula_ChartSetsForOpenCPN.html">license
        conditions</a> of <a href="https://o-charts.org/shop/en/content/3-our-conditions">o-charts</a><br>
      Especially it is not allowed to copy the charts or use them on other than
      the licensed systems.</p>
    <p>Access to the charts in AvNav is only possible from within the local net.
      You can connect at most 5 devices (Clients) at the same time.</p>
    <p>For software licenses see the <a href="https://github.com/wellenvogel/ochartsng/blob/master/Readme.md">Readme.</a></p>
    <h2><a name="PluginConfig"></a> Plugin Configuration</h2>
    <p>Linux only. For Android refer to <a href="#androidsettings">Android/Settings</a>.<br>
      Some of the plugins settings can be changed on the server/status page <img
        src="../viewerimages/icons-new/status.svg" alt="" class="inlineimage">
      at "plugins/system-ochartsng" .</p>
    <p><img src="ochartsng-edit-plugin.png" class="fimage"> </p>
    <p>Those are:</p>
    <table border="1" width="100%">
      <tbody>
        <tr>
          <td>Name</td>
          <td>Meaning</td>
          <td>Default</td>
        </tr>
        <tr>
          <td>port</td>
          <td>Http port </td>
          <td>8082</td>
        </tr>
        <tr>
          <td>debug</td>
          <td>log level for &lt;datadir&gt;/ocharts/provider.log.<br>
            &lt;datadir&gt; on a raspberry is /home/pi/avnav/data</td>
          <td>1</td>
        </tr>
        <tr>
          <td>memPercent</td>
          <td>The amount of memory (percent of the system memory) that the
            plugin (correctly: the provider process) will use. If this value is
            not set (or set to low) the provider will use an internal minimum.<br>
            This potentially could be rather low - especially when using raster
            charts. If it is very low the provider must open and close chart
            files very often and this will slow down it's operation. If you have
            enough memory (e.g. 2GB) you can increase speed by setting the
            memory to 1GB .</td>
          <td>50</td>
        </tr>
        <tr>
          <td>tileCachekb</td>
          <td>KB of memory to be used for the internal tile cache (set to 0 to
            disable it for some testing)</td>
          <td>40960</td>
        </tr>
        <tr>
          <td>useLegacy</td>
          <td>Also use the charts that have been installed with the old
            avnav-ocharts-plugin. By activating this you can disable the old
            plugin in the settings and just use all the charts you already
            installed.</td>
          <td>off</td>
        </tr>
      </tbody>
    </table>
    <h2><a name="Details"></a></h2>
    <h2><a name="android"></a>Android App</h2>
    <p>AvNav OchartsNG also runs on Android and provides charts for the <a href="../android/android.html">AvNav
        android app</a>.<br>
      The Ocharts support is built into a separate Android App - avocharts.</p>
    <p>Currently the app is not (yet) available in the google play store as it
      is still in beta status. So you need to download it from the <a href="../../downloads/daily-ochartsng">daily
        builds directory</a> and install it (allow external sources).</p>
    <p><img src="ochartsng-android-main.jpg" class="fimage"></p>
    <p>After you started up avocharts for the first time you can adapt some
      settings.<br>
      When you see this picture the real ocharts provider process is still not
      running - it will start up when you tap "start".</p>
    <p><a name="androidstartup"></a>Later it will not be necessary to start the
      avocharts app by hand - it should normally being started automatically
      when AvNav starts up. But directly starting the avocharts app can help to
      troubleshoot as you can get access to the output and log of the chart
      provider.<br>
      Please consider that the auto start will only work for apps of the same
      type - i.e. an AvNav release app can only start an avocharts release&nbsp;
      app and an AvNav beta app can only start an avocharts beta app.<br>
      So when you install the avocharts beta together with the "normal" AvNav
      app from the store you need to start avocharts by hand before you can use
      the charts in AvNav.</p>
    <h3><a name="androidsettings"></a>Settings</h3>
    <p>To adapt settings tap on the shown settings or on the settings icon on
      the upper right.</p>
    <p><img src="ochartsng-android-settings.jpg" alt="" class="fimage"></p>
    <br>
    <table border="1" width="100%">
      <tbody>
        <tr>
          <td>Name</td>
          <td>Explanation</td>
          <td>Default</td>
        </tr>
        <tr>
          <td>Port</td>
          <td>The IP Port the provider process will use. If you get errors when
            you start the provider and see something like "address already in
            use" in the output (tapping the out button on the main page) you
            maybe need to change the port</td>
          <td>8082</td>
        </tr>
        <tr>
          <td>LogLevel</td>
          <td>0 - errors, 1- info, 2- debug</td>
          <td>1</td>
        </tr>
        <tr>
          <td>Shutdown</td>
          <td>Time (in seconds) the provider will wait for a heartbeat from
            AvNav before it stops (only active when started by AvNav)</td>
          <td>30</td>
        </tr>
        <tr>
          <td>Memory</td>
          <td>Allowed Memory usage (%) of the system memory</td>
          <td>50</td>
        </tr>
        <tr>
          <td>Testmode</td>
          <td>internal testing only</td>
          <td>false</td>
        </tr>
        <tr>
          <td>Use alt key</td>
          <td>See below for the <a href="#androidbetarelease">hints</a> about
            Release/Beta Versions</td>
          <td><br>
          </td>
        </tr>
        <tr>
          <td>Disk symbol (upper right)</td>
          <td>Save your key (See below for the <a href="#androidbetarelease" style="color: black;">hints</a>
            about Release/Beta Versions)</td>
          <td><br>
          </td>
        </tr>
      </tbody>
    </table>
    <p>When done with the settings tap the back arrow.</p>
    <p>You can now start the chart provider by tapping "START".</p>
    <p><img src="ochartsng-android-running.jpg" class="fimage"></p>
    <p>When the provider process is up an running you will see the indication in
      the notification bar. If something goes wrong just try to have a look at
      the output (tapping "OUT") or the log (tapping "LOG").</p>
    <p>Tapping "APP" will open up a browser window with the ochartsng app - the
      same view like you get from within AvNav.</p>
    <p><img src="ochartsng-android-webmain.jpg" alt="" class="fimage"></p>
    <p>You now can e.g. register at the ocharts shop (on android this is only
      possible using the Online Process).</p>
    <h3><a name="androidbetarelease"></a>Beta and Release Versions</h3>
    <p>Due to the way that the ocharts license daemon is working you will
      normally not be able to use charts that you installed with the release
      version within the beta version and vice versa.<br>
      To overcome this problem you can export the necessary information from the
      app version that you used to assign the charts and import this in the
      different version. Hint: You still can only use this on the same android
      device!<br>
      To export a key tap the disk symbol on the settings screen within the app
      and store the file at a safe place. When you later use the alternative
      version, select "use alternate key" , tap on the key value and import the
      saved key file there.<br>
      You can easily check if your app has the correct key by going to the shop
      page and log in. When the shop recognizes your current key it will show
      the system name - see <a href="#onlineprocess">Online Process</a>. </p>
    <p>Please also consider the <a href="#androidstartup">automatic startup
        relations</a> between the Beta and Release version.</p>
    <h2>Technical Details</h2>
    <p>The charts are provided by an executable that normally serves at port
      8082. <br>
      Communication with AvNav is handled by an AvNav <a href="plugins.html">plugin</a>
      on linux and by the avocharts app on Android.</p>
    <p>The GUI is a reactjs app that is also provided by the executable. It is
      integrated into AvNav as a <a href="../userdoc/addonpage.html">User App</a>.</p>
    <p>You will find the complete code at <a href="https://github.com/wellenvogel/ochartsng">GitHub</a>.</p>
    <p>You install into /usr/lib/avnav/plugins/ochartsng. The data directory is
      /home/pi/avnav/data/ochartsng. You can set some additional parameters for
      the AvNav plugin by editing <a href="configfile.html">avnav_server.xml</a>.
      Normally this is not necessary at all. </p>
    <p><a name="Upload"></a>You can separately set the directory for all
      settings and the charts: </p>
    <div class="code">&lt;AVNPluginHandler&gt;<br>...<br>&lt;system-ochartsng dataDir="$DATADIR/ochartsng"/&gt;<br>&lt;/AVNPluginHandler&gt;</div>
    <br>
    <p> </p>
    <h3> <a name="chartconversions"></a>Chart Conversions </h3>
    <p>Unencrypted vector charts like S57 charts have to be converted into the
      internally used "SENC" format before they can be handled.<br>
      There are 2 Options to convert such charts.</p>
    <h4>Converting using OpenCPN</h4>
    <p>If you already have a computer with OpenCPN up and running you can let
      OpenCPN convert the charts. To do so you need to activate the charts in
      OpenCPN. On the OpenCPN settings / tab "chart files" just click "Prepare
      all ENC Charts".</p>
    <p><img src="ochartsng-convert-opencpn.png" alt="" class="fimage"></p>
    <p>This will create a lot of files with the s57 extension in the OpenCPN
      directory (~/.opencpn on linux). Just pick the ones with similar names
      like your s57 charts, copy them in a new, empty directory with a name that
      explains the chart set. Afterwards create a text file "Chartinfo.txt" in
      this directory with just one line of text:</p>
    <p class="code">ChartInfo: nameOfTheChart</p>
    <p>Create a zip archive from this directory so that the zip archive has this
      directory inside. This archive can be uploaded to AvNav ochartsng.<br>
      On Linux there is a <a href="https://github.com/wellenvogel/ochartsng/blob/master/tools/collectS57.sh">script</a>
      to automate this collection process.</p>
    <h4>Converting with a Script</h4>
    <p>The avnav-ochartsng-plugin contains a python script to convert S57 data
      into a zip archive that can be uploaded. So if you have a linux system
      with the plugin being installed you can run the script with</p>
    <p class="code">/usr/lib/anvnav/plugins/ochartsng/tosenc.py input output</p>
    <p>Input can either be a directory with the s57 files (.000,.001,...) or a
      zip file that contains them. Output should be the name of a zip file.</p>
    Later on the converter will be integrated into the AvNav chart converter.
  </body>
</html>
